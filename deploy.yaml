apps:
  - name: nes_fe
    script: .output/server/index.mjs
    interpreter: 'bun'
    instances: max
    exec_mode: cluster
    env:
      PORT: 3001
      NODE_ENV: production
      NES_API_BASE: 'http://localhost:8081'

deploy:
  production:
    user: 'root'
    host: '69.62.86.33'
    ref: 'origin/main'
    repo: 'https://github.com/swiftzL/nes_fe'
    path: '/var/www/nes_fe'
    pre-deploy: 'source ~/.bashrc && git fetch --all'
    post-deploy: 'export PATH=$HOME/.bun/bin:$PATH && export PATH=$HOME/n/bin:$PATH && bun install && bun run build && pm2 reload deploy.yaml'
    env:
      NES_API_BASE: 'http://127.0.0.1:8081'
