apps:
  - name: nes_fe
    script: .output/server/index.mjs
    instances: max
    exec_mode: cluster
    node_args: '--env-file .env'
    env:
      PORT: 3001
      NODE_ENV: production
      NES_API_BASE: 'http://localhost:8081'

deploy:
  production:
    user: 'root'
    host: '69.62.86.33'
    ref: 'origin/main'
    repo: 'https://github.com/swiftzL/nes_fe'
    path: '/var/www/nes_fe'
    pre-deploy: 'source ~/.bashrc && git fetch --all'
    post-deploy: 'export PATH=$HOME/n/bin:$PATH && npm install && npm run build && pm2 reload deploy.yaml'
    env:
      NES_API_BASE: 'http://127.0.0.1:8081'
      NES_EMULATOR_BASE: 'https://cdn.jsdelivr.net/npm/@ttgame/emulatorjs@4.2.5/data'
